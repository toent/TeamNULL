<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmation - Mario & Luigi's Pizzeria</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/order.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/gSTYLE.css') }}">
    <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='images/marioLuigiPizzeriaTempLogoV2.png') }}">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Italianno&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Italiana&display=swap" rel="stylesheet">
</head>
<body>

<div class="container" id="color-container">
    <div class="bar-container">
        <div class="bar green"></div>
        <div class="bar white"></div>
        <div class="bar red"></div>
    </div>
    <div class="center-text" id="center-text">
        <p>Your Cart</p>
    </div>
    <div class="cart-items"></div>
    <p class="total-price-container">Total Price: &euro; <span class="total-price">0</span> </p>
</div>

<!-- Confirm Order Button to open modal -->
<button class="open-confirm-modal confirm-btn">Confirm Order</button>

<!-- The Modal -->
<div id="orderModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Order Confirmation</h2>
        <p id="modal-message">Do you want to confirm your order?</p>
        <!-- Confirm Button inside the Modal -->
        <button id="modal-confirm-order" class="confirm-btn">Confirm Order</button>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
    const cartItemsContainer = document.querySelector('.cart-items');
    const totalPriceDisplay = document.querySelector('.total-price');
    let totalPrice = 0;
 
    // Display each cart item and calculate total price
    cartItemsContainer.innerHTML = cartItems.map(item => {
        totalPrice += item.price;
        return `<div class="cart-item">
<strong>${item.name}</strong><br>
                    Price: ${item.price} &euro;
</div>`;
    }).join('');
    totalPriceDisplay.textContent = totalPrice.toFixed(2);
 
    // Modal handling elements
    const modal = document.getElementById("orderModal");
    const closeModalButton = modal.querySelector(".close");
    const openModalButton = document.querySelector(".open-confirm-modal");
    const modalConfirmButton = document.getElementById("modal-confirm-order");
 
    // Open modal on "Confirm Order" button click
    openModalButton.addEventListener('click', () => {
        modal.style.display = "block";
    });
 
    // Close modal when "X" is clicked
    closeModalButton.addEventListener('click', () => {
        modal.style.display = "none";
    });
 
    // Close modal if clicked outside of content
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    };
 
    // Confirm order and send cart data to server
    modalConfirmButton.addEventListener('click', () => {
        fetch('/submit_order', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(cartItems)
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            // Clear cart
            localStorage.removeItem('cartItems');
            // Close modal and reload page
            modal.style.display = "none";
            window.location.reload(); // Reload to clear the cart display
        })
        .catch(error => console.error('Error:', error));
    });
});
</script>

</body>
</html>
